generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  STUDENT
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tests        Test[]
  submissions  TestSubmission[]
}

model Test {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  duration    Int

  // âœ… ONLY ADDITION (THIS FIXES YOUR ERROR)
  scheduledStart DateTime?
  scheduledEnd   DateTime?

  createdAt   DateTime @default(now())
  createdById Int
  createdBy   User     @relation(fields: [createdById], references: [id])

  questions    Question[]
  submissions  TestSubmission[]
}

model Question {
  id            Int      @id @default(autoincrement())
  text          String
  type          String
  options       String[]
  correctAnswer String

  testId  Int
  test    Test @relation(fields: [testId], references: [id], onDelete: Cascade)

  answers Answer[]
}

model TestSubmission {
  id         Int      @id @default(autoincrement())
  testId     Int
  studentId Int
  score      Int
  status     String
  createdAt DateTime @default(now())

  test    Test @relation(fields: [testId], references: [id])
  student User @relation(fields: [studentId], references: [id])

  answers Answer[]
}

model Answer {
  id             Int      @id @default(autoincrement())
  selectedAnswer String
  isCorrect      Boolean

  questionId   Int
  submissionId Int

  question   Question       @relation(fields: [questionId], references: [id])
  submission TestSubmission @relation(fields: [submissionId], references: [id])
}
